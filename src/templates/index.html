<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸å®‰è¶‹åŠ¿åˆ†æ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        .header {
            text-align: center;
            padding: 20px 0 30px;
        }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .header .time { color: #888; font-size: 14px; }
        .header .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: 10px;
        }
        .status.loading { background: #f39c12; }
        .status.ok { background: #27ae60; }
        .status.error { background: #e74c3c; }

        .container { max-width: 1400px; margin: 0 auto; }

        .symbols-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 20px;
        }

        .symbol-card {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 24px;
            backdrop-filter: blur(10px);
        }

        .symbol-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .symbol-name { font-size: 24px; font-weight: bold; }
        .symbol-price { font-size: 28px; font-weight: bold; }
        .price-change { font-size: 16px; margin-left: 10px; }
        .price-change.up { color: #00d4aa; }
        .price-change.down { color: #ff6b6b; }

        .intervals-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .interval-card {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }
        .interval-name { font-size: 14px; color: #888; margin-bottom: 8px; }
        .interval-direction {
            font-size: 16px;
            font-weight: bold;
            padding: 6px 12px;
            border-radius: 8px;
            display: inline-block;
        }
        .direction-bullish { background: rgba(0,212,170,0.2); color: #00d4aa; }
        .direction-bearish { background: rgba(255,107,107,0.2); color: #ff6b6b; }
        .direction-neutral { background: rgba(255,255,255,0.1); color: #888; }

        .interval-meta { font-size: 12px; color: #666; margin-top: 8px; }
        .interval-score { font-size: 13px; margin-top: 4px; }

        .resonance-box {
            background: linear-gradient(135deg, rgba(102,126,234,0.2), rgba(118,75,162,0.2));
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        .resonance-title { font-size: 14px; color: #888; margin-bottom: 10px; }
        .resonance-level { font-size: 20px; font-weight: bold; margin-bottom: 5px; }
        .resonance-signal { font-size: 24px; font-weight: bold; }
        .resonance-signal.bullish { color: #00d4aa; }
        .resonance-signal.bearish { color: #ff6b6b; }
        .resonance-signal.neutral { color: #f39c12; }
        .resonance-confidence {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            margin-top: 10px;
        }
        .confidence-high { background: #27ae60; }
        .confidence-medium { background: #f39c12; }
        .confidence-low { background: #666; }

        /* äº¤æ˜“å»ºè®®å¡ç‰‡æ ·å¼ */
        .advice-box {
            background: linear-gradient(135deg, rgba(30,30,50,0.9), rgba(20,20,40,0.9));
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .advice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .advice-title {
            font-size: 14px;
            color: #888;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .advice-action {
            font-size: 18px;
            font-weight: bold;
            padding: 6px 16px;
            border-radius: 8px;
        }
        .advice-action.long {
            background: rgba(0,212,170,0.2);
            color: #00d4aa;
            border: 1px solid rgba(0,212,170,0.3);
        }
        .advice-action.short {
            background: rgba(255,107,107,0.2);
            color: #ff6b6b;
            border: 1px solid rgba(255,107,107,0.3);
        }
        .advice-action.wait {
            background: rgba(255,255,255,0.1);
            color: #888;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .advice-reason {
            font-size: 13px;
            color: #aaa;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
        }
        .advice-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }
        .advice-item {
            background: rgba(255,255,255,0.03);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        .advice-item .label {
            font-size: 11px;
            color: #666;
            margin-bottom: 4px;
        }
        .advice-item .value {
            font-size: 14px;
            font-weight: 600;
        }
        .advice-item .value.bullish { color: #00d4aa; }
        .advice-item .value.bearish { color: #ff6b6b; }
        .advice-item .value.neutral { color: #f39c12; }
        .advice-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .risk-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
        }
        .risk-badge.low { background: rgba(39,174,96,0.2); color: #27ae60; }
        .risk-badge.medium { background: rgba(243,156,18,0.2); color: #f39c12; }
        .risk-badge.high { background: rgba(231,76,60,0.2); color: #e74c3c; }

        /* æ æ†å»ºè®®æ ·å¼ */
        .leverage-box {
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, rgba(243,156,18,0.1), rgba(230,126,34,0.1));
            border: 1px solid rgba(243,156,18,0.2);
            border-radius: 8px;
            padding: 12px 16px;
            margin-top: 12px;
        }
        .leverage-icon {
            font-size: 18px;
        }
        .leverage-text {
            flex: 1;
            font-size: 13px;
            color: #f39c12;
        }
        .leverage-badge {
            background: rgba(243,156,18,0.2);
            color: #f39c12;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
        }
        .advice-tips {
            background: rgba(255,255,255,0.02);
            border-radius: 8px;
            padding: 12px;
        }
        .advice-tips .tip-title {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }
        .advice-tips ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .advice-tips li {
            font-size: 12px;
            color: #aaa;
            padding: 4px 0;
            padding-left: 16px;
            position: relative;
        }
        .advice-tips li::before {
            content: 'â€¢';
            position: absolute;
            left: 0;
            color: #4a90d9;
        }

        /* å‘¨æœŸåˆ‡æ¢ Tab æ ·å¼ */
        .advice-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }
        .advice-tab {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            background: rgba(255,255,255,0.05);
            color: #888;
            border: 1px solid transparent;
            transition: all 0.2s ease;
        }
        .advice-tab:hover {
            background: rgba(255,255,255,0.1);
            color: #ccc;
        }
        .advice-tab.active {
            background: rgba(74,144,217,0.2);
            color: #4a90d9;
            border-color: rgba(74,144,217,0.3);
        }

        /* ææƒ§è´ªå©ªæŒ‡æ•°æ ·å¼ */
        .fng-section {
            margin-bottom: 25px;
        }
        .fng-card {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        .fng-content {
            display: flex;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        .fng-gauge {
            position: relative;
            width: 120px;
            height: 120px;
        }
        .fng-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        .fng-value .number {
            font-size: 36px;
            font-weight: bold;
        }
        .fng-value .label {
            font-size: 14px;
            margin-top: 2px;
        }
        .fng-value.extreme-fear .number { color: #ff6b6b; }
        .fng-value.fear .number { color: #ffa07a; }
        .fng-value.neutral .number { color: #f39c12; }
        .fng-value.greed .number { color: #90ee90; }
        .fng-value.extreme-greed .number { color: #00d4aa; }
        .fng-info {
            flex: 1;
            min-width: 250px;
        }
        .fng-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .fng-sentiment {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 8px;
        }
        .fng-signal {
            font-size: 13px;
            color: #4a90d9;
            padding: 10px;
            background: rgba(74,144,217,0.1);
            border-radius: 8px;
            border-left: 3px solid #4a90d9;
        }
        .fng-meta {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
        }
        .fng-bar {
            width: 100%;
            height: 8px;
            background: linear-gradient(to right, #ff6b6b 0%, #ffa07a 25%, #f39c12 50%, #90ee90 75%, #00d4aa 100%);
            border-radius: 4px;
            position: relative;
            margin: 15px 0 5px;
        }
        .fng-bar-indicator {
            position: absolute;
            top: -4px;
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            transform: translateX(-50%);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .fng-bar-labels {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #666;
        }

        /* å‡†ç¡®ç‡ç»Ÿè®¡æ ·å¼ */
        .accuracy-section {
            margin-bottom: 25px;
        }
        .accuracy-card {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        .accuracy-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .accuracy-title {
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .accuracy-overall {
            font-size: 24px;
            font-weight: bold;
        }
        .accuracy-overall.high { color: #00d4aa; }
        .accuracy-overall.medium { color: #f39c12; }
        .accuracy-overall.low { color: #ff6b6b; }
        .accuracy-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .accuracy-stat-group {
            flex: 1;
            min-width: 200px;
        }
        .accuracy-stat-title {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
        }
        .accuracy-stat-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .accuracy-stat-item {
            background: rgba(255,255,255,0.03);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
        }
        .accuracy-stat-item .label {
            color: #888;
            margin-right: 6px;
        }
        .accuracy-stat-item .value {
            font-weight: 600;
        }
        .accuracy-stat-item .value.high { color: #00d4aa; }
        .accuracy-stat-item .value.medium { color: #f39c12; }
        .accuracy-stat-item .value.low { color: #ff6b6b; }
        .accuracy-meta {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #666;
            margin-top: 12px;
        }
        .accuracy-empty {
            text-align: center;
            color: #666;
            padding: 15px;
            font-size: 13px;
        }

        .footer {
            text-align: center;
            padding: 30px 0;
            color: #666;
            font-size: 12px;
        }

        @media (max-width: 768px) {
            .intervals-grid { grid-template-columns: repeat(2, 1fr); }
            .symbols-grid { grid-template-columns: 1fr; }
            .advice-grid { grid-template-columns: repeat(2, 1fr); }
            .advice-meta { flex-direction: column; gap: 8px; align-items: flex-start; }
        }
        @media (max-width: 1024px) and (min-width: 769px) {
            .intervals-grid { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å¸å®‰è¶‹åŠ¿åˆ†æ</h1>
            <div>
                <a href="/chart" style="color:#4a90d9; text-decoration:none; margin-right:15px; font-size:14px;">Kçº¿å›¾è¡¨</a>
                <span class="time" id="updateTime">åŠ è½½ä¸­...</span>
                <span class="status loading" id="status">åˆ·æ–°ä¸­</span>
            </div>
        </div>

        <div class="fng-section" id="fngSection">
            <div class="fng-card">
                <div class="accuracy-empty">ææƒ§è´ªå©ªæŒ‡æ•°åŠ è½½ä¸­...</div>
            </div>
        </div>

        <div class="accuracy-section" id="accuracySection">
            <div class="accuracy-card">
                <div class="accuracy-empty">å‡†ç¡®ç‡ç»Ÿè®¡åŠ è½½ä¸­...</div>
            </div>
        </div>

        <div class="symbols-grid" id="symbolsContainer">
            <div style="text-align:center; padding: 50px; color: #888;">åŠ è½½æ•°æ®ä¸­...</div>
        </div>

        <div class="footer">
            é£é™©æç¤ºï¼šä»¥ä¸Šåˆ†æä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ï¼ŒæŠ•èµ„æœ‰é£é™©ï¼Œå…¥å¸‚éœ€è°¨æ…ï¼
        </div>
    </div>

    <script>
        const refreshInterval = {{ refresh_interval }} * 1000;

        // æŒä¹…åŒ–ç”¨æˆ·é€‰æ‹©çš„å‘¨æœŸ
        function getSelectedInterval(symbol) {
            const saved = localStorage.getItem(`adviceInterval_${symbol}`);
            return saved || '1h';  // é»˜è®¤1h
        }

        function setSelectedInterval(symbol, interval) {
            localStorage.setItem(`adviceInterval_${symbol}`, interval);
        }

        function getDirectionClass(direction) {
            if (direction.includes('æ¶¨') || direction.includes('å¤š')) return 'bullish';
            if (direction.includes('è·Œ') || direction.includes('ç©º')) return 'bearish';
            return 'neutral';
        }

        function getConfidenceClass(confidence) {
            if (['æé«˜', 'é«˜', 'ä¸­é«˜'].includes(confidence)) return 'high';
            if (confidence === 'ä¸­') return 'medium';
            return 'low';
        }

        function intervalToMinutes(interval) {
            const num = parseInt(interval);
            if (interval.endsWith('m')) return num;
            if (interval.endsWith('h')) return num * 60;
            if (interval.endsWith('d')) return num * 60 * 24;
            if (interval.endsWith('w')) return num * 60 * 24 * 7;
            return num;
        }

        function sortIntervals(intervals) {
            return Object.entries(intervals).sort((a, b) =>
                intervalToMinutes(a[0]) - intervalToMinutes(b[0])
            );
        }

        function formatPrice(price) {
            return price >= 1000 ? price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})
                                 : price.toFixed(4);
        }

        function getRiskClass(riskLevel) {
            if (riskLevel === 'ä½' || riskLevel === 'ä¸­ä½') return 'low';
            if (riskLevel === 'é«˜' || riskLevel === 'ä¸­é«˜') return 'high';
            return 'medium';
        }

        function renderAdviceBox(advice, interval) {
            if (!advice) return '';

            const actionClass = advice.action_en || 'wait';
            const isOpen = actionClass !== 'wait';

            let priceGridHtml = '';
            if (isOpen && advice.stop_loss) {
                const slClass = actionClass === 'long' ? 'bearish' : 'bullish';
                const tp1Class = actionClass === 'long' ? 'bullish' : 'bearish';

                priceGridHtml = `
                    <div class="advice-grid">
                        <div class="advice-item">
                            <div class="label">æ­¢æŸä»·</div>
                            <div class="value ${slClass}">$${formatPrice(advice.stop_loss)}</div>
                        </div>
                        <div class="advice-item">
                            <div class="label">æ­¢ç›ˆ1 (30%)</div>
                            <div class="value ${tp1Class}">$${formatPrice(advice.take_profit_1)}</div>
                        </div>
                        <div class="advice-item">
                            <div class="label">æ­¢ç›ˆ2 (40%)</div>
                            <div class="value ${tp1Class}">$${formatPrice(advice.take_profit_2)}</div>
                        </div>
                        <div class="advice-item">
                            <div class="label">æ­¢ç›ˆ3 (30%)</div>
                            <div class="value ${tp1Class}">$${formatPrice(advice.take_profit_3)}</div>
                        </div>
                    </div>
                `;
            }

            const tipsHtml = advice.key_points && advice.key_points.length > 0
                ? `<div class="advice-tips">
                       <div class="tip-title">å…³é”®æç¤º</div>
                       <ul>${advice.key_points.map(tip => `<li>${tip}</li>`).join('')}</ul>
                   </div>`
                : '';

            const leverageHtml = isOpen && advice.max_leverage
                ? `<div class="leverage-box">
                       <span class="leverage-icon">âš¡</span>
                       <span class="leverage-text">${advice.leverage_suggestion}</span>
                       <span class="leverage-badge">${advice.safe_leverage}x - ${advice.max_leverage}x</span>
                   </div>`
                : '';

            const metaHtml = isOpen
                ? `<div class="advice-meta">
                       <span>ä»“ä½: ${advice.position_suggestion || '-'}</span>
                       <span>é£é™©æ”¶ç›Šæ¯”: ${advice.risk_reward_ratio || '-'}</span>
                       <span class="risk-badge ${getRiskClass(advice.risk_level)}">é£é™©: ${advice.risk_level}</span>
                   </div>
                   ${leverageHtml}`
                : '';

            return `
                <div class="advice-box">
                    <div class="advice-header">
                        <span class="advice-title">ğŸ“Š ${interval} äº¤æ˜“å»ºè®®</span>
                        <span class="advice-action ${actionClass}">${advice.action}</span>
                    </div>
                    <div class="advice-reason">${advice.reason || 'æš‚æ— å»ºè®®'}</div>
                    ${priceGridHtml}
                    ${metaHtml}
                    ${tipsHtml}
                </div>
            `;
        }

        function renderData(data) {
            const container = document.getElementById('symbolsContainer');
            let html = '';

            for (const [symbol, symbolData] of Object.entries(data.symbols)) {
                const firstInterval = Object.values(symbolData.intervals)[0];
                const price = firstInterval.current_price;
                const change = firstInterval.stats_24h?.price_change_percent || 0;
                const changeClass = change >= 0 ? 'up' : 'down';
                const changeSign = change >= 0 ? '+' : '';

                html += `
                    <div class="symbol-card">
                        <div class="symbol-header">
                            <span class="symbol-name">${symbol.replace('USDT', '/USDT')}</span>
                            <div>
                                <span class="symbol-price">$${formatPrice(price)}</span>
                                <span class="price-change ${changeClass}">${changeSign}${change.toFixed(2)}%</span>
                            </div>
                        </div>

                        <div class="intervals-grid">
                `;

                for (const [interval, iData] of sortIntervals(symbolData.intervals)) {
                    const pred = iData.prediction;
                    const dirClass = getDirectionClass(pred.direction);
                    html += `
                        <div class="interval-card">
                            <div class="interval-name">${interval}</div>
                            <div class="interval-direction direction-${dirClass}">${pred.direction}</div>
                            <div class="interval-score">è¯„åˆ†: ${pred.score} (${pred.volume_weight.toFixed(1)}x)</div>
                            <div class="interval-meta">ç½®ä¿¡åº¦: ${pred.confidence}</div>
                        </div>
                    `;
                }

                const res = symbolData.resonance;
                const resClass = getDirectionClass(res.signal);
                const confClass = getConfidenceClass(res.confidence);

                html += `
                        </div>
                        <div class="resonance-box">
                            <div class="resonance-title">å¤šå‘¨æœŸå…±æŒ¯åˆ†æ</div>
                            <div class="resonance-level">${res.resonance_level}</div>
                            <div class="resonance-signal ${resClass}">${res.signal}</div>
                            <div><span class="resonance-confidence confidence-${confClass}">ç½®ä¿¡åº¦: ${res.confidence}</span></div>
                        </div>
                `;

                // æ˜¾ç¤ºå‘¨æœŸåˆ‡æ¢Tabå’Œäº¤æ˜“å»ºè®®
                const adviceIntervals = ['5m', '30m', '1h', '4h', '1d'];
                const symbolId = symbol.replace(/[^a-zA-Z0-9]/g, '');
                const selectedInterval = getSelectedInterval(symbolId);

                html += `<div class="advice-tabs">`;
                for (const intv of adviceIntervals) {
                    const hasAdvice = symbolData.intervals[intv]?.trading_advice;
                    const activeClass = intv === selectedInterval ? 'active' : '';
                    const disabledStyle = hasAdvice ? '' : 'opacity: 0.4; pointer-events: none;';
                    html += `<span class="advice-tab ${activeClass}" style="${disabledStyle}"
                                   data-symbol="${symbolId}" data-interval="${intv}">${intv}</span>`;
                }
                html += `</div>`;

                // æ¸²æŸ“æ‰€æœ‰å‘¨æœŸçš„å»ºè®®ï¼Œæ˜¾ç¤ºç”¨æˆ·é€‰æ‹©çš„å‘¨æœŸ
                for (const intv of adviceIntervals) {
                    const intvData = symbolData.intervals[intv];
                    if (intvData && intvData.trading_advice) {
                        const displayStyle = intv === selectedInterval ? '' : 'display: none;';
                        html += `<div class="advice-content" data-symbol="${symbolId}" data-interval="${intv}" style="${displayStyle}">`;
                        html += renderAdviceBox(intvData.trading_advice, intv);
                        html += `</div>`;
                    }
                }

                // å…³é—­ symbol-card div
                html += `</div>`;
            }

            container.innerHTML = html;

            // ç»‘å®šTabåˆ‡æ¢äº‹ä»¶
            bindAdviceTabs();
        }

        function bindAdviceTabs() {
            document.querySelectorAll('.advice-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const symbol = this.dataset.symbol;
                    const interval = this.dataset.interval;

                    // ä¿å­˜ç”¨æˆ·é€‰æ‹©åˆ° localStorage
                    setSelectedInterval(symbol, interval);

                    // åˆ‡æ¢Tab activeçŠ¶æ€
                    document.querySelectorAll(`.advice-tab[data-symbol="${symbol}"]`).forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');

                    // åˆ‡æ¢å†…å®¹æ˜¾ç¤º
                    document.querySelectorAll(`.advice-content[data-symbol="${symbol}"]`).forEach(content => {
                        content.style.display = content.dataset.interval === interval ? '' : 'none';
                    });
                });
            });
        }

        function getAccuracyClass(accuracy) {
            if (accuracy >= 60) return 'high';
            if (accuracy >= 45) return 'medium';
            return 'low';
        }

        function renderAccuracyStats(data) {
            const section = document.getElementById('accuracySection');

            if (!data || data.verified_count === 0) {
                section.innerHTML = `
                    <div class="accuracy-card">
                        <div class="accuracy-empty">
                            æš‚æ— å·²éªŒè¯çš„é¢„æµ‹æ•°æ®ï¼Œç³»ç»Ÿå°†åœ¨é¢„æµ‹åè‡ªåŠ¨éªŒè¯å‡†ç¡®ç‡
                            <br><small style="color:#555">ï¼ˆå¾…éªŒè¯: ${data?.pending_count || 0} æ¡ï¼‰</small>
                        </div>
                    </div>
                `;
                return;
            }

            const overallClass = getAccuracyClass(data.overall_accuracy);

            // æŒ‰å‘¨æœŸç»Ÿè®¡
            let intervalHtml = '';
            const intervals = ['5m', '30m', '1h', '4h', '1d'];
            for (const intv of intervals) {
                const stat = data.by_interval[intv];
                if (stat) {
                    const accClass = getAccuracyClass(stat.accuracy);
                    intervalHtml += `
                        <div class="accuracy-stat-item">
                            <span class="label">${intv}</span>
                            <span class="value ${accClass}">${stat.accuracy}%</span>
                            <span style="color:#555;font-size:11px">(${stat.correct}/${stat.total})</span>
                        </div>
                    `;
                }
            }

            // æŒ‰ç½®ä¿¡åº¦ç»Ÿè®¡
            let confidenceHtml = '';
            const confidenceOrder = ['æé«˜', 'é«˜', 'ä¸­é«˜', 'ä¸­', 'ä½'];
            for (const conf of confidenceOrder) {
                const stat = data.by_confidence[conf];
                if (stat) {
                    const accClass = getAccuracyClass(stat.accuracy);
                    confidenceHtml += `
                        <div class="accuracy-stat-item">
                            <span class="label">${conf}</span>
                            <span class="value ${accClass}">${stat.accuracy}%</span>
                            <span style="color:#555;font-size:11px">(${stat.correct}/${stat.total})</span>
                        </div>
                    `;
                }
            }

            section.innerHTML = `
                <div class="accuracy-card">
                    <div class="accuracy-header">
                        <span class="accuracy-title">ğŸ“Š é¢„æµ‹å‡†ç¡®ç‡ç»Ÿè®¡</span>
                        <span class="accuracy-overall ${overallClass}">${data.overall_accuracy}%</span>
                    </div>
                    <div class="accuracy-stats">
                        <div class="accuracy-stat-group">
                            <div class="accuracy-stat-title">æŒ‰å‘¨æœŸ</div>
                            <div class="accuracy-stat-items">${intervalHtml || '<span style="color:#666">æš‚æ— æ•°æ®</span>'}</div>
                        </div>
                        <div class="accuracy-stat-group">
                            <div class="accuracy-stat-title">æŒ‰ç½®ä¿¡åº¦</div>
                            <div class="accuracy-stat-items">${confidenceHtml || '<span style="color:#666">æš‚æ— æ•°æ®</span>'}</div>
                        </div>
                    </div>
                    <div class="accuracy-meta">
                        <span>å·²éªŒè¯: ${data.verified_count} æ¡</span>
                        <span>æ­£ç¡®: ${data.correct_count} æ¡</span>
                        <span>å¾…éªŒè¯: ${data.pending_count} æ¡</span>
                    </div>
                </div>
            `;
        }

        function getFngClass(value) {
            if (value <= 24) return 'extreme-fear';
            if (value <= 44) return 'fear';
            if (value <= 55) return 'neutral';
            if (value <= 75) return 'greed';
            return 'extreme-greed';
        }

        function renderFearGreed(data) {
            const section = document.getElementById('fngSection');

            if (!data) {
                section.innerHTML = `
                    <div class="fng-card">
                        <div class="accuracy-empty">ææƒ§è´ªå©ªæŒ‡æ•°è·å–å¤±è´¥</div>
                    </div>
                `;
                return;
            }

            const fngClass = getFngClass(data.value);
            const barPosition = data.value + '%';

            section.innerHTML = `
                <div class="fng-card">
                    <div class="fng-content">
                        <div class="fng-gauge">
                            <svg viewBox="0 0 120 120" width="120" height="120">
                                <circle cx="60" cy="60" r="54" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="8"/>
                                <circle cx="60" cy="60" r="54" fill="none" stroke="url(#fngGradient)" stroke-width="8"
                                    stroke-dasharray="${data.value * 3.39} 339"
                                    stroke-linecap="round"
                                    transform="rotate(-90 60 60)"/>
                                <defs>
                                    <linearGradient id="fngGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" stop-color="#ff6b6b"/>
                                        <stop offset="50%" stop-color="#f39c12"/>
                                        <stop offset="100%" stop-color="#00d4aa"/>
                                    </linearGradient>
                                </defs>
                            </svg>
                            <div class="fng-value ${fngClass}">
                                <div class="number">${data.value}</div>
                                <div class="label">${data.classification}</div>
                            </div>
                        </div>
                        <div class="fng-info">
                            <div class="fng-title">
                                <span>Fear & Greed Index</span>
                            </div>
                            <div class="fng-sentiment">${data.sentiment}</div>
                            <div class="fng-signal">${data.signal}</div>
                            <div class="fng-bar">
                                <div class="fng-bar-indicator" style="left: ${barPosition}"></div>
                            </div>
                            <div class="fng-bar-labels">
                                <span>æåº¦ææƒ§</span>
                                <span>ææƒ§</span>
                                <span>ä¸­æ€§</span>
                                <span>è´ªå©ª</span>
                                <span>æåº¦è´ªå©ª</span>
                            </div>
                            <div class="fng-meta">æ›´æ–°æ—¶é—´: ${data.update_time}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function fetchFearGreed() {
            try {
                const response = await fetch('/api/fear-greed');
                const result = await response.json();
                if (result.success) {
                    renderFearGreed(result.data);
                }
            } catch (error) {
                console.error('è·å–ææƒ§è´ªå©ªæŒ‡æ•°å¤±è´¥:', error);
            }
        }

        async function fetchAccuracy() {
            try {
                const response = await fetch('/api/accuracy');
                const result = await response.json();
                if (result.success) {
                    renderAccuracyStats(result.data);
                }
            } catch (error) {
                console.error('è·å–å‡†ç¡®ç‡æ•°æ®å¤±è´¥:', error);
            }
        }

        async function fetchData() {
            const status = document.getElementById('status');
            status.textContent = 'åˆ·æ–°ä¸­';
            status.className = 'status loading';

            try {
                const response = await fetch('/api/analysis');
                const result = await response.json();

                if (result.success) {
                    renderData(result.data);
                    document.getElementById('updateTime').textContent = 'æ›´æ–°äº ' + result.data.timestamp;
                    status.textContent = 'æ­£å¸¸';
                    status.className = 'status ok';
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                status.textContent = 'é”™è¯¯';
                status.className = 'status error';
                console.error('è·å–æ•°æ®å¤±è´¥:', error);
            }
        }

        // åˆå§‹åŒ–åŠ è½½
        fetchData();
        fetchAccuracy();
        fetchFearGreed();

        // å®šæ—¶åˆ·æ–°
        setInterval(fetchData, refreshInterval);
        setInterval(fetchAccuracy, refreshInterval * 2);  // å‡†ç¡®ç‡åˆ·æ–°é¢‘ç‡å‡åŠ
        setInterval(fetchFearGreed, refreshInterval * 5);  // ææƒ§è´ªå©ªæŒ‡æ•°åˆ·æ–°é¢‘ç‡æ›´ä½ï¼ˆ5åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ï¼‰
    </script>
</body>
</html>
